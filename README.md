# flow-generator-matching-distillation

This is an official implementation and corresponding experiments on [Flow Generator Matching (FGM)](https://arxiv.org/pdf/2410.19310) - an innovative approach designed to accelerate the sampling of flow-matching models into a one-step generation.

The goal is to train a one-step generator model $g_{\theta}$, which directly transports a random noise $z \sim p_z$
to obtain a sample $x = g_{\theta}(z)$. Let $p_{\theta,0}$ denote the distribution of the student model over the
generated by teacher sample $x$, and $p_{\theta,t}$ denote the marginal probability path transitioned with $q_t(x_t|x_{\theta})$, i.e.,

$$
p_{\theta,t}(x_t) = \int
q_t(x_t|x_0)p_{\theta,0}(x_0) dx_0
$$

One-step flow generator matching aims to let the student distribution $p_{\theta,0}$
match the data distribution $q_{\theta}$. For this, we consider matching the marginal vector field $v_{\theta,t}$ with the
pre-trained one $u_t$ such that the distributions $p_{\theta,0}$ and $q_{\theta}$ can match with one another:

$$
L_{FM}(\theta) := \mathbb{E}_{t,x_t \sim p_{\theta,t}} ||v_{\theta, t}(x_t) - u_t(x_t)||^2 =
$$
$$
= \mathbb{E}_{\substack{t, z \sim p_z(z), x_{0}=g_{\theta}(z),\\ x_t \sim q_t(x_t|x_{\theta})}} 
||v_{\theta, t}(x_t) - u_t(x_t)||^2 \rightarrow \min_{\theta}
$$

Our official technical report and theoretical part of distillations you can find here: [Report](https://drive.google.com/file/d/1YS1KzRWXeIw1R-vZkOWmVUhal0j8_Psz/view?usp=sharing)
